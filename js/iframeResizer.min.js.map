{"version":3,"file":"iframeResizer.min.js","sources":["../src/iframeResizer.js"],"sourcesContent":["/*\n * File: iframeResizer.js\n * Desc: Force iframes to size to content.\n * Requires: iframeResizer.contentWindow.js to be loaded into the target frame.\n * Doc: https://github.com/davidjbradshaw/iframe-resizer\n * Author: David J. Bradshaw - dave@bradshaw.net\n * Contributor: Jure Mav - jure.mav@gmail.com\n * Contributor: Reed Dadoune - reed@dadoune.com\n */\n\n(function (undefined) {\n  if (typeof window === 'undefined') return; // don't run for server side render\n\n  let count = 0;\n  let logEnabled = false;\n  let hiddenCheckEnabled = false;\n  const msgHeader = 'message';\n  const msgHeaderLen = msgHeader.length;\n  const msgId = '[iFrameSizer]'; // Must match iframe msg ID\n  const msgIdLen = msgId.length;\n  let pagePosition = null;\n  let requestAnimationFrame = window.requestAnimationFrame;\n  const resetRequiredMethods = {\n    max: 1,\n    scroll: 1,\n    bodyScroll: 1,\n    documentElementScroll: 1,\n  };\n  const settings = {};\n  let timer = null;\n  const defaults = {\n    autoResize: true,\n    bodyBackground: null,\n    bodyMargin: null,\n    bodyMarginV1: 8,\n    bodyPadding: null,\n    checkOrigin: true,\n    inPageLinks: false,\n    enablePublicMethods: true,\n    heightCalculationMethod: 'bodyOffset',\n    id: 'iFrameResizer',\n    interval: 32,\n    log: false,\n    maxHeight: Infinity,\n    maxWidth: Infinity,\n    minHeight: 0,\n    minWidth: 0,\n    mouseEvents: true,\n    resizeFrom: 'parent',\n    scrolling: false,\n    sizeHeight: true,\n    sizeWidth: false,\n    warningTimeout: 5000,\n    tolerance: 0,\n    widthCalculationMethod: 'scroll',\n    onClose: function () {\n      return true;\n    },\n    onClosed: function () {},\n    onInit: function () {},\n    onMessage: function () {\n      warn('onMessage function not defined');\n    },\n    onMouseEnter: function () {},\n    onMouseLeave: function () {},\n    onResized: function () {},\n    onScroll: function () {\n      return true;\n    },\n  };\n\n  function getMutationObserver () {\n    return (\n      window.MutationObserver ||\n      window.WebKitMutationObserver ||\n      window.MozMutationObserver\n    );\n  }\n\n  function addEventListener (el, evt, func) {\n    el.addEventListener(evt, func, false);\n  }\n\n  function removeEventListener (el, evt, func) {\n    el.removeEventListener(evt, func, false);\n  }\n\n  function setupRequestAnimationFrame () {\n    const vendors = ['moz', 'webkit', 'o', 'ms'];\n    let x;\n\n    // Remove vendor prefixing if prefixed and break early if not\n    for (x = 0; x < vendors.length && !requestAnimationFrame; x += 1) {\n      requestAnimationFrame = window[vendors[x] + 'RequestAnimationFrame'];\n    }\n\n    if (requestAnimationFrame) {\n      // Firefox extension content-scripts\n      // have a globalThis object that is not the same as window.\n      // Binding `requestAnimationFrame`\n      // to window allows the function to work and prevents errors\n      // being thrown when run in that context,\n      // and should be a no-op in every other context.\n      requestAnimationFrame = requestAnimationFrame.bind(window);\n    } else {\n      log('setup', 'RequestAnimationFrame not supported');\n    }\n  }\n\n  function getMyID (iframeId) {\n    let retStr = 'Host page: ' + iframeId;\n\n    if (window.top !== window.self) {\n      retStr =\n        window.parentIFrame && window.parentIFrame.getId\n          ? window.parentIFrame.getId() + ': ' + iframeId\n          : 'Nested host page: ' + iframeId;\n    }\n\n    return retStr;\n  }\n\n  function formatLogHeader (iframeId) {\n    return msgId + '[' + getMyID(iframeId) + ']';\n  }\n\n  function isLogEnabled (iframeId) {\n    return settings[iframeId] ? settings[iframeId].log : logEnabled;\n  }\n\n  function log (iframeId, msg) {\n    output('log', iframeId, msg, isLogEnabled(iframeId));\n  }\n\n  function info (iframeId, msg) {\n    output('info', iframeId, msg, isLogEnabled(iframeId));\n  }\n\n  function warn (iframeId, msg) {\n    output('warn', iframeId, msg, true);\n  }\n\n  function output (type, iframeId, msg, enabled) {\n    if (enabled === true && typeof window.console === 'object') {\n      // eslint-disable-next-line no-console\n      console[type](formatLogHeader(iframeId), msg);\n    }\n  }\n\n  function iFrameListener (event) {\n    function resizeIFrame () {\n      function resize () {\n        setSize(messageData);\n        setPagePosition(iframeId);\n        on('onResized', messageData);\n      }\n\n      ensureInRange('Height');\n      ensureInRange('Width');\n\n      syncResize(resize, messageData, 'init');\n    }\n\n    function processMsg () {\n      const data = msg.slice(msgIdLen).split(':');\n      const height = data[1] ? parseInt(data[1], 10) : 0;\n      const iframe = settings[data[0]] && settings[data[0]].iframe;\n      const compStyle = getComputedStyle(iframe);\n\n      return {\n        iframe,\n        id: data[0],\n        height: height + getPaddingEnds(compStyle) + getBorderEnds(compStyle),\n        width: data[2],\n        type: data[3],\n      };\n    }\n\n    function getPaddingEnds (compStyle) {\n      if (compStyle.boxSizing !== 'border-box') {\n        return 0;\n      }\n\n      const top = compStyle.paddingTop ? parseInt(compStyle.paddingTop, 10) : 0;\n      const bot = compStyle.paddingBottom\n        ? parseInt(compStyle.paddingBottom, 10)\n        : 0;\n\n      return top + bot;\n    }\n\n    function getBorderEnds (compStyle) {\n      if (compStyle.boxSizing !== 'border-box') {\n        return 0;\n      }\n\n      const top = compStyle.borderTopWidth\n        ? parseInt(compStyle.borderTopWidth, 10)\n        : 0;\n      const bot = compStyle.borderBottomWidth\n        ? parseInt(compStyle.borderBottomWidth, 10)\n        : 0;\n\n      return top + bot;\n    }\n\n    function ensureInRange (Dimension) {\n      const max = Number(settings[iframeId]['max' + Dimension]);\n      const min = Number(settings[iframeId]['min' + Dimension]);\n      const dimension = Dimension.toLowerCase();\n      let size = Number(messageData[dimension]);\n\n      log(\n        iframeId,\n        'Checking ' + dimension + ' is in range ' + min + '-' + max\n      );\n\n      if (size < min) {\n        size = min;\n        log(iframeId, 'Set ' + dimension + ' to min value');\n      }\n\n      if (size > max) {\n        size = max;\n        log(iframeId, 'Set ' + dimension + ' to max value');\n      }\n\n      messageData[dimension] = '' + size;\n    }\n\n    function isMessageFromIFrame () {\n      function checkAllowedOrigin () {\n        function checkList () {\n          let i = 0;\n          let retCode = false;\n\n          log(\n            iframeId,\n            'Checking connection is from allowed list of origins: ' +\n              checkOrigin\n          );\n\n          for (; i < checkOrigin.length; i++) {\n            if (checkOrigin[i] === origin) {\n              retCode = true;\n              break;\n            }\n          }\n\n          return retCode;\n        }\n\n        function checkSingle () {\n          const remoteHost =\n            settings[iframeId] && settings[iframeId].remoteHost;\n          log(iframeId, 'Checking connection is from: ' + remoteHost);\n\n          return origin === remoteHost;\n        }\n\n        return checkOrigin.constructor === Array ? checkList() : checkSingle();\n      }\n\n      var origin = event.origin;\n      var checkOrigin = settings[iframeId] && settings[iframeId].checkOrigin;\n\n      if (checkOrigin && '' + origin !== 'null' && !checkAllowedOrigin()) {\n        throw new Error(\n          'Unexpected message received from: ' +\n            origin +\n            ' for ' +\n            messageData.iframe.id +\n            '. Message was: ' +\n            event.data +\n            '. This error can be disabled by setting the checkOrigin: ' +\n            'false option or by providing of array of trusted domains.'\n        );\n      }\n\n      return true;\n    }\n\n    function isMessageForUs () {\n      return (\n        msgId === ('' + msg).slice(0, msgIdLen) &&\n        msg.slice(msgIdLen).split(':')[0] in settings\n      ); // ''+Protects against non-string msg\n    }\n\n    function isMessageFromMetaParent () {\n      // Test if this message is from a parent above us.\n      // This is an ugly test, however, updating\n      // the message format would break backwards compatibility.\n      const retCode = messageData.type in { true: 1, false: 1, undefined: 1 };\n\n      if (retCode) {\n        log(iframeId, 'Ignoring init message from meta parent page');\n      }\n\n      return retCode;\n    }\n\n    function getMsgBody (offset) {\n      return msg.slice(msg.indexOf(':') + msgHeaderLen + offset);\n    }\n\n    function forwardMsgFromIFrame (msgBody) {\n      log(\n        iframeId,\n        'onMessage passed: {iframe: ' +\n          messageData.iframe.id +\n          ', message: ' +\n          msgBody +\n          '}'\n      );\n\n      on('onMessage', {\n        iframe: messageData.iframe,\n        message: JSON.parse(msgBody),\n      });\n\n      log(iframeId, '--');\n    }\n\n    function getPageInfo () {\n      const bodyPosition = document.body.getBoundingClientRect();\n      const iFramePosition = messageData.iframe.getBoundingClientRect();\n\n      return JSON.stringify({\n        iframeHeight: iFramePosition.height,\n        iframeWidth: iFramePosition.width,\n        clientHeight: Math.max(\n          document.documentElement.clientHeight,\n          window.innerHeight || 0\n        ),\n        clientWidth: Math.max(\n          document.documentElement.clientWidth,\n          window.innerWidth || 0\n        ),\n        offsetTop: parseInt(iFramePosition.top - bodyPosition.top, 10),\n        offsetLeft: parseInt(iFramePosition.left - bodyPosition.left, 10),\n        scrollTop: window.pageYOffset,\n        scrollLeft: window.pageXOffset,\n        documentHeight: document.documentElement.clientHeight,\n        documentWidth: document.documentElement.clientWidth,\n        windowHeight: window.innerHeight,\n        windowWidth: window.innerWidth,\n      });\n    }\n\n    function sendPageInfoToIframe (iframe, iframeId) {\n      function debouncedTrigger () {\n        trigger(\n          'Send Page Info', 'pageInfo:' + getPageInfo(),\n          iframe,\n          iframeId\n        );\n      }\n\n      debounceFrameEvents(debouncedTrigger, 32, iframeId);\n    }\n\n    function startPageInfoMonitor () {\n      function setListener (type, func) {\n        function sendPageInfo () {\n          if (settings[id]) {\n            sendPageInfoToIframe(settings[id].iframe, id);\n          } else {\n            stop();\n          }\n        }\n\n        ['scroll', 'resize'].forEach(function (evt) {\n          log(id, type + evt + ' listener for sendPageInfo');\n          func(window, evt, sendPageInfo);\n        });\n      }\n\n      function stop () {\n        setListener('Remove ', removeEventListener);\n      }\n\n      function start () {\n        setListener('Add ', addEventListener);\n      }\n\n      var id = iframeId; // Create locally scoped copy of iFrame ID\n\n      start();\n\n      if (settings[id]) {\n        settings[id].stopPageInfo = stop;\n      }\n    }\n\n    function stopPageInfoMonitor () {\n      if (settings[iframeId] && settings[iframeId].stopPageInfo) {\n        settings[iframeId].stopPageInfo();\n        delete settings[iframeId].stopPageInfo;\n      }\n    }\n\n    function checkIFrameExists () {\n      let retBool = true;\n\n      if (messageData.iframe === null) {\n        warn(iframeId, 'IFrame (' + messageData.id + ') not found');\n        retBool = false;\n      }\n\n      return retBool;\n    }\n\n    function getElementPosition (target) {\n      const iFramePosition = target.getBoundingClientRect();\n\n      getPagePosition(iframeId);\n\n      return {\n        x: Math.floor(Number(iFramePosition.left) + Number(pagePosition.x)),\n        y: Math.floor(Number(iFramePosition.top) + Number(pagePosition.y)),\n      };\n    }\n\n    function scrollRequestFromChild (addOffset) {\n      /* istanbul ignore next */ // Not testable in Karma\n      function reposition () {\n        pagePosition = newPosition;\n        scrollTo();\n        log(iframeId, '--');\n      }\n\n      function calcOffset () {\n        return {\n          x: Number(messageData.width) + offset.x,\n          y: Number(messageData.height) + offset.y,\n        };\n      }\n\n      function scrollParent () {\n        if (window.parentIFrame) {\n          window.parentIFrame['scrollTo' + (addOffset ? 'Offset' : '')](\n            newPosition.x,\n            newPosition.y\n          );\n        } else {\n          warn(\n            iframeId,\n            'Unable to scroll to requested position, ' +\n            'window.parentIFrame not found'\n          );\n        }\n      }\n\n      var offset = addOffset\n        ? getElementPosition(messageData.iframe)\n        : { x: 0, y: 0 };\n      var newPosition = calcOffset();\n\n      log(\n        iframeId,\n        'Reposition requested from iFrame (offset x:' +\n          offset.x +\n          ' y:' +\n          offset.y +\n          ')'\n      );\n\n      if (window.top === window.self) {\n        reposition();\n      } else {\n        scrollParent();\n      }\n    }\n\n    function scrollTo () {\n      if (on('onScroll', pagePosition) === false) {\n        unsetPagePosition();\n      } else {\n        setPagePosition(iframeId);\n      }\n    }\n\n    function findTarget (location) {\n      function jumpToTarget () {\n        const jumpPosition = getElementPosition(target);\n\n        log(\n          iframeId,\n          'Moving to in page link (#' +\n            hash +\n            ') at x: ' +\n            jumpPosition.x +\n            ' y: ' +\n            jumpPosition.y\n        );\n        pagePosition = {\n          x: jumpPosition.x,\n          y: jumpPosition.y,\n        };\n\n        scrollTo();\n        log(iframeId, '--');\n      }\n\n      function jumpToParent () {\n        if (window.parentIFrame) {\n          window.parentIFrame.moveToAnchor(hash);\n        } else {\n          log(\n            iframeId,\n            'In page link #' +\n              hash +\n              ' not found and window.parentIFrame not found'\n          );\n        }\n      }\n\n      var hash = location.split('#')[1] || '';\n      const hashData = decodeURIComponent(hash);\n      var target =\n          document.getElementById(hashData) ||\n          document.getElementsByName(hashData)[0];\n\n      if (target) {\n        jumpToTarget();\n      } else if (window.top === window.self) {\n        log(iframeId, 'In page link #' + hash + ' not found');\n      } else {\n        jumpToParent();\n      }\n    }\n\n    function onMouse (event) {\n      let mousePos = {};\n\n      if (Number(messageData.width) === 0 && Number(messageData.height) === 0) {\n        const data = getMsgBody(9).split(':');\n        mousePos = {\n          x: data[1],\n          y: data[0],\n        };\n      } else {\n        mousePos = {\n          x: messageData.width,\n          y: messageData.height,\n        };\n      }\n\n      on(event, {\n        iframe: messageData.iframe,\n        screenX: Number(mousePos.x),\n        screenY: Number(mousePos.y),\n        type: messageData.type,\n      });\n    }\n\n    function on (funcName, val) {\n      return chkEvent(iframeId, funcName, val);\n    }\n\n    function actionMsg () {\n      if (settings[iframeId] && settings[iframeId].firstRun) firstRun();\n\n      switch (messageData.type) {\n        case 'close': {\n          closeIFrame(messageData.iframe);\n          break;\n        }\n\n        case 'message': {\n          forwardMsgFromIFrame(getMsgBody(6));\n          break;\n        }\n\n        case 'mouseenter': {\n          onMouse('onMouseEnter');\n          break;\n        }\n\n        case 'mouseleave': {\n          onMouse('onMouseLeave');\n          break;\n        }\n\n        case 'autoResize': {\n          settings[iframeId].autoResize = JSON.parse(getMsgBody(9));\n          break;\n        }\n\n        case 'scrollTo': {\n          scrollRequestFromChild(false);\n          break;\n        }\n\n        case 'scrollToOffset': {\n          scrollRequestFromChild(true);\n          break;\n        }\n\n        case 'pageInfo': {\n          sendPageInfoToIframe(\n            settings[iframeId] && settings[iframeId].iframe,\n            iframeId\n          );\n          startPageInfoMonitor();\n          break;\n        }\n\n        case 'pageInfoStop': {\n          stopPageInfoMonitor();\n          break;\n        }\n\n        case 'inPageLink': {\n          findTarget(getMsgBody(9));\n          break;\n        }\n\n        case 'reset': {\n          resetIFrame(messageData);\n          break;\n        }\n\n        case 'init': {\n          resizeIFrame();\n          on('onInit', messageData.iframe);\n          break;\n        }\n\n        default: {\n          if (\n            Number(messageData.width) === 0 &&\n            Number(messageData.height) === 0\n          ) {\n            warn(\n              'Unsupported message received (' +\n                messageData.type +\n                '), this is likely due to the iframe containing a later ' +\n                'version of iframe-resizer than the parent page'\n            );\n          } else {\n            resizeIFrame();\n          }\n        }\n      }\n    }\n\n    function hasSettings (iframeId) {\n      let retBool = true;\n\n      if (!settings[iframeId]) {\n        retBool = false;\n        warn(\n          messageData.type +\n            ' No settings for ' +\n            iframeId +\n            '. Message was: ' +\n            msg\n        );\n      }\n\n      return retBool;\n    }\n\n    function iFrameReadyMsgReceived () {\n      // eslint-disable-next-line no-restricted-syntax, guard-for-in\n      for (const iframeId in settings) {\n        trigger(\n          'iFrame requested init',\n          createOutgoingMsg(iframeId),\n          settings[iframeId].iframe,\n          iframeId\n        );\n      }\n    }\n\n    function firstRun () {\n      if (settings[iframeId]) {\n        settings[iframeId].firstRun = false;\n      }\n    }\n\n    var msg = event.data;\n    var messageData = {};\n    var iframeId = null;\n\n    if (msg === '[iFrameResizerChild]Ready') {\n      iFrameReadyMsgReceived();\n    } else if (isMessageForUs()) {\n      messageData = processMsg();\n      iframeId = messageData.id;\n\n      if (settings[iframeId]) {\n        settings[iframeId].loaded = true;\n      }\n\n      if (!isMessageFromMetaParent() && hasSettings(iframeId)) {\n        log(iframeId, 'Received: ' + msg);\n\n        if (checkIFrameExists() && isMessageFromIFrame()) {\n          actionMsg();\n        }\n      }\n    } else {\n      info(iframeId, 'Ignored: ' + msg);\n    }\n  }\n\n  function chkEvent (iframeId, funcName, val) {\n    let func = null;\n    let retVal = null;\n\n    if (settings[iframeId]) {\n      func = settings[iframeId][funcName];\n\n      if (typeof func === 'function') {\n        retVal = func(val);\n      } else {\n        throw new TypeError(\n          funcName + ' on iFrame[' + iframeId + '] is not a function'\n        );\n      }\n    }\n\n    return retVal;\n  }\n\n  function removeIframeListeners (iframe) {\n    const iframeId = iframe.id;\n    delete settings[iframeId];\n  }\n\n  function closeIFrame (iframe) {\n    const iframeId = iframe.id;\n\n    if (chkEvent(iframeId, 'onClose', iframeId) === false) {\n      log(iframeId, 'Close iframe cancelled by onClose event');\n\n      return;\n    }\n\n    log(iframeId, 'Removing iFrame: ' + iframeId);\n\n    try {\n      // Catch race condition error with React\n      if (iframe.parentNode) {\n        iframe.parentNode.removeChild(iframe);\n      }\n    } catch (error) {\n      warn(error);\n    }\n\n    chkEvent(iframeId, 'onClosed', iframeId);\n    log(iframeId, '--');\n    removeIframeListeners(iframe);\n  }\n\n  function getPagePosition (iframeId) {\n    if (pagePosition === null) {\n      pagePosition = {\n        x:\n          window.pageXOffset === undefined\n            ? document.documentElement.scrollLeft\n            : window.pageXOffset,\n        y:\n          window.pageYOffset === undefined\n            ? document.documentElement.scrollTop\n            : window.pageYOffset,\n      };\n      log(\n        iframeId,\n        'Get page position: ' + pagePosition.x + ',' + pagePosition.y\n      );\n    }\n  }\n\n  function setPagePosition (iframeId) {\n    if (pagePosition !== null) {\n      window.scrollTo(pagePosition.x, pagePosition.y);\n      log(\n        iframeId,\n        'Set page position: ' + pagePosition.x + ',' + pagePosition.y\n      );\n      unsetPagePosition();\n    }\n  }\n\n  function unsetPagePosition () {\n    pagePosition = null;\n  }\n\n  function resetIFrame (messageData) {\n    function reset () {\n      setSize(messageData);\n      trigger('reset', 'reset', messageData.iframe, messageData.id);\n    }\n\n    log(\n      messageData.id,\n      'Size reset requested by ' +\n        (messageData.type === 'init' ? 'host page' : 'iFrame')\n    );\n    getPagePosition(messageData.id);\n    syncResize(reset, messageData, 'reset');\n  }\n\n  function setSize (messageData) {\n    function setDimension (dimension) {\n      if (!messageData.id) {\n        log('undefined', 'messageData id not set');\n\n        return;\n      }\n\n      messageData.iframe.style[dimension] = messageData[dimension] + 'px';\n      log(\n        messageData.id,\n        'IFrame (' +\n          iframeId +\n          ') ' +\n          dimension +\n          ' set to ' +\n          messageData[dimension] +\n          'px'\n      );\n    }\n\n    function chkZero (dimension) {\n      // FireFox sets dimension of hidden iFrames to zero.\n      // So if we detect that set up an event to check for\n      // when iFrame becomes visible.\n\n      /* istanbul ignore next */ // Not testable in PhantomJS\n      if (!hiddenCheckEnabled && messageData[dimension] === '0') {\n        hiddenCheckEnabled = true;\n        log(iframeId, 'Hidden iFrame detected, creating visibility listener');\n        fixHiddenIFrames();\n      }\n    }\n\n    function processDimension (dimension) {\n      setDimension(dimension);\n      chkZero(dimension);\n    }\n\n    var iframeId = messageData.iframe.id;\n\n    if (settings[iframeId]) {\n      if (settings[iframeId].sizeHeight) {\n        processDimension('height');\n      }\n\n      if (settings[iframeId].sizeWidth) {\n        processDimension('width');\n      }\n    }\n  }\n\n  function syncResize (func, messageData, doNotSync) {\n    /* istanbul ignore if */ // Not testable in PhantomJS\n    if (\n      doNotSync !== messageData.type &&\n      requestAnimationFrame &&\n      // including check for jasmine because had trouble getting\n      // spy to work in unit test using requestAnimationFrame\n      !window.jasmine\n    ) {\n      log(messageData.id, 'Requesting animation frame');\n      requestAnimationFrame(func);\n    } else {\n      func();\n    }\n  }\n\n  function trigger (calleeMsg, msg, iframe, id, noResponseWarning) {\n    function postMessageToIFrame () {\n      const target = settings[id] && settings[id].targetOrigin;\n      log(\n        id,\n        '[' +\n          calleeMsg +\n          '] Sending msg to iframe[' +\n          id +\n          '] (' +\n          msg +\n          ') targetOrigin: ' +\n          target\n      );\n      iframe.contentWindow.postMessage(msgId + msg, target);\n    }\n\n    function iFrameNotFound () {\n      warn(id, '[' + calleeMsg + '] IFrame(' + id + ') not found');\n    }\n\n    function chkAndSend () {\n      if (\n        iframe &&\n        'contentWindow' in iframe &&\n        iframe.contentWindow !== null\n      ) {\n        // Null test for PhantomJS\n        postMessageToIFrame();\n      } else {\n        iFrameNotFound();\n      }\n    }\n\n    function warnOnNoResponse () {\n      function warning () {\n        if (settings[id] && !settings[id].loaded && !errorShown) {\n          errorShown = true;\n          warn(\n            id,\n            'IFrame has not responded within ' +\n              settings[id].warningTimeout / 1000 +\n              ' seconds. Check iFrameResizer.contentWindow.js ' +\n              'has been loaded in iFrame. This message can be ignored if ' +\n              'everything is working, or you can set the warningTimeout ' +\n              'option to a higher value or zero to suppress this warning.'\n          );\n        }\n      }\n\n      if (\n        !!noResponseWarning &&\n        settings[id] &&\n        !!settings[id].warningTimeout\n      ) {\n        settings[id].msgTimeout = setTimeout(\n          warning,\n          settings[id].warningTimeout\n        );\n      }\n    }\n\n    var errorShown = false;\n\n    id = id || iframe.id;\n\n    if (settings[id]) {\n      chkAndSend();\n      warnOnNoResponse();\n    }\n  }\n\n  function createOutgoingMsg (iframeId) {\n    return (\n      iframeId +\n      ':' +\n      settings[iframeId].bodyMarginV1 +\n      ':' +\n      settings[iframeId].sizeWidth +\n      ':' +\n      settings[iframeId].log +\n      ':' +\n      settings[iframeId].interval +\n      ':' +\n      settings[iframeId].enablePublicMethods +\n      ':' +\n      settings[iframeId].autoResize +\n      ':' +\n      settings[iframeId].bodyMargin +\n      ':' +\n      settings[iframeId].heightCalculationMethod +\n      ':' +\n      settings[iframeId].bodyBackground +\n      ':' +\n      settings[iframeId].bodyPadding +\n      ':' +\n      settings[iframeId].tolerance +\n      ':' +\n      settings[iframeId].inPageLinks +\n      ':' +\n      settings[iframeId].resizeFrom +\n      ':' +\n      settings[iframeId].widthCalculationMethod +\n      ':' +\n      settings[iframeId].mouseEvents\n    );\n  }\n\n  function isNumber (value) {\n    return typeof value === 'number';\n  }\n\n  function setupIFrame (iframe, options) {\n    function setLimits () {\n      function addStyle (style) {\n        const styleValue = settings[iframeId][style];\n\n        if (Infinity !== styleValue && styleValue !== 0) {\n          iframe.style[style] = isNumber(styleValue)\n            ? styleValue + 'px'\n            : styleValue;\n          log(iframeId, 'Set ' + style + ' = ' + iframe.style[style]);\n        }\n      }\n\n      function chkMinMax (dimension) {\n        if (\n          settings[iframeId]['min' + dimension] >\n          settings[iframeId]['max' + dimension]\n        ) {\n          throw new Error(\n            'Value for min' +\n              dimension +\n              ' can not be greater than max' +\n              dimension\n          );\n        }\n      }\n\n      chkMinMax('Height');\n      chkMinMax('Width');\n\n      addStyle('maxHeight');\n      addStyle('minHeight');\n      addStyle('maxWidth');\n      addStyle('minWidth');\n    }\n\n    function newId () {\n      let id = (options && options.id) || defaults.id + count++;\n\n      if (document.getElementById(id) !== null) {\n        id += count++;\n      }\n\n      return id;\n    }\n\n    function ensureHasId (iframeId) {\n      if (iframeId === '') {\n        // eslint-disable-next-line no-multi-assign\n        iframe.id = iframeId = newId();\n        logEnabled = (options || {}).log;\n        log(\n          iframeId,\n          'Added missing iframe ID: ' + iframeId + ' (' + iframe.src + ')'\n        );\n      }\n\n      return iframeId;\n    }\n\n    function setScrolling () {\n      log(\n        iframeId,\n        'IFrame scrolling ' +\n          (settings[iframeId] && settings[iframeId].scrolling\n            ? 'enabled'\n            : 'disabled') +\n          ' for ' +\n          iframeId\n      );\n      iframe.style.overflow =\n        (settings[iframeId] && settings[iframeId].scrolling) === false\n          ? 'hidden'\n          : 'auto';\n\n      switch (settings[iframeId] && settings[iframeId].scrolling) {\n        case 'omit': {\n          break;\n        }\n\n        case true: {\n          iframe.scrolling = 'yes';\n          break;\n        }\n\n        case false: {\n          iframe.scrolling = 'no';\n          break;\n        }\n\n        default: {\n          iframe.scrolling = settings[iframeId]\n            ? settings[iframeId].scrolling\n            : 'no';\n        }\n      }\n    }\n\n    // The V1 iFrame script expects an int, where as in V2 expects a CSS\n    // string value such as '1px 3em', so if we have an int for V2, set V1=V2\n    // and then convert V2 to a string PX value.\n    function setupBodyMarginValues () {\n      if (\n        typeof (settings[iframeId] && settings[iframeId].bodyMargin) ===\n          'number' ||\n        (settings[iframeId] && settings[iframeId].bodyMargin) === '0'\n      ) {\n        settings[iframeId].bodyMarginV1 = settings[iframeId].bodyMargin;\n        settings[iframeId].bodyMargin =\n          '' + settings[iframeId].bodyMargin + 'px';\n      }\n    }\n\n    function checkReset () {\n      // Reduce scope of firstRun to function, because IE8's JS execution\n      // context stack is borked and this value gets externally\n      // changed midway through running this function!!!\n      const firstRun = settings[iframeId] && settings[iframeId].firstRun;\n      const resetRequertMethod =\n          settings[iframeId] &&\n          settings[iframeId].heightCalculationMethod in resetRequiredMethods;\n\n      if (!firstRun && resetRequertMethod) {\n        resetIFrame({ iframe, height: 0, width: 0, type: 'init' });\n      }\n    }\n\n    function setupIFrameObject () {\n      if (settings[iframeId]) {\n        settings[iframeId].iframe.iFrameResizer = {\n          close: closeIFrame.bind(null, settings[iframeId].iframe),\n\n          removeListeners: removeIframeListeners.bind(\n            null,\n            settings[iframeId].iframe\n          ),\n\n          resize: trigger.bind(\n            null,\n            'Window resize',\n            'resize',\n            settings[iframeId].iframe\n          ),\n\n          moveToAnchor: function (anchor) {\n            trigger(\n              'Move to anchor',\n              'moveToAnchor:' + anchor,\n              settings[iframeId].iframe,\n              iframeId\n            );\n          },\n\n          sendMessage: function (message) {\n            message = JSON.stringify(message);\n            trigger(\n              'Send Message',\n              'message:' + message,\n              settings[iframeId].iframe,\n              iframeId\n            );\n          },\n        };\n      }\n    }\n\n    // We have to call trigger twice, as we can not be sure if all\n    // iframes have completed loading when this code runs. The\n    // event listener also catches the page changing in the iFrame.\n    function init (msg) {\n      function iFrameLoaded () {\n        trigger('iFrame.onload', msg, iframe, undefined, true);\n        checkReset();\n      }\n\n      function createDestroyObserver (MutationObserver) {\n        if (!iframe.parentNode) {\n          return;\n        }\n\n        const destroyObserver = new MutationObserver(function (mutations) {\n          mutations.forEach(function (mutation) {\n            // Transform NodeList into an Array\n            const removedNodes =\n              Array.prototype.slice.call(mutation.removedNodes);\n            removedNodes.forEach(function (removedNode) {\n              if (removedNode === iframe) {\n                closeIFrame(iframe);\n              }\n            });\n          });\n        });\n        destroyObserver.observe(iframe.parentNode, {\n          childList: true,\n        });\n      }\n\n      const MutationObserver = getMutationObserver();\n\n      if (MutationObserver) {\n        createDestroyObserver(MutationObserver);\n      }\n\n      addEventListener(iframe, 'load', iFrameLoaded);\n      trigger('init', msg, iframe, undefined, true);\n    }\n\n    function checkOptions (options) {\n      if (typeof options !== 'object') {\n        throw new TypeError('Options is not an object');\n      }\n    }\n\n    function copyOptions (options) {\n      // eslint-disable-next-line no-restricted-syntax\n      for (const option in defaults) {\n        if (Object.prototype.hasOwnProperty.call(defaults, option)) {\n          settings[iframeId][option] = Object.prototype.hasOwnProperty.call(\n            options,\n            option\n          )\n            ? options[option]\n            : defaults[option];\n        }\n      }\n    }\n\n    function getTargetOrigin (remoteHost) {\n      return remoteHost === '' ||\n        remoteHost.match(/^(about:blank|javascript:|file:\\/\\/)/) !== null\n        ? '*'\n        : remoteHost;\n    }\n\n    function depricate (key) {\n      const splitName = key.split('Callback');\n\n      if (splitName.length === 2) {\n        const name =\n          'on' + splitName[0].charAt(0).toUpperCase() + splitName[0].slice(1);\n        this[name] = this[key];\n        delete this[key];\n        warn(\n          iframeId,\n          \"Deprecated: '\" +\n            key +\n            \"' has been renamed '\" +\n            name +\n            \"'. The old method will be removed in the next major version.\"\n        );\n      }\n    }\n\n    function processOptions (options) {\n      options = options || {};\n      settings[iframeId] = {\n        firstRun: true,\n        iframe,\n        remoteHost: iframe.src && iframe.src.split('/').slice(0, 3).join('/'),\n      };\n\n      checkOptions(options);\n      Object.keys(options).forEach(depricate, options);\n      copyOptions(options);\n\n      if (settings[iframeId]) {\n        settings[iframeId].targetOrigin =\n          settings[iframeId].checkOrigin === true\n            ? getTargetOrigin(settings[iframeId].remoteHost)\n            : '*';\n      }\n    }\n\n    function beenHere () {\n      return iframeId in settings && 'iFrameResizer' in iframe;\n    }\n\n    var iframeId = ensureHasId(iframe.id);\n\n    if (beenHere()) {\n      warn(iframeId, 'Ignored iFrame, already setup.');\n    } else {\n      processOptions(options);\n      setScrolling();\n      setLimits();\n      setupBodyMarginValues();\n      init(createOutgoingMsg(iframeId));\n      setupIFrameObject();\n    }\n  }\n\n  function debouce (fn, time) {\n    if (timer === null) {\n      timer = setTimeout(function () {\n        timer = null;\n        fn();\n      }, time);\n    }\n  }\n\n  const frameTimer = {};\n\n  function debounceFrameEvents (fn, time, frameId) {\n    if (!frameTimer[frameId]) {\n      frameTimer[frameId] = setTimeout(function () {\n        frameTimer[frameId] = null;\n        fn();\n      }, time);\n    }\n  }\n\n  // Not testable in PhantomJS\n  /* istanbul ignore next */\n\n  function fixHiddenIFrames () {\n    function checkIFrames () {\n      function checkIFrame (settingId) {\n        function chkDimension (dimension) {\n          return (\n            (settings[settingId] &&\n              settings[settingId].iframe.style[dimension]) === '0px'\n          );\n        }\n\n        function isVisible (el) {\n          return el.offsetParent !== null;\n        }\n\n        if (\n          settings[settingId] &&\n          isVisible(settings[settingId].iframe) &&\n          (chkDimension('height') || chkDimension('width'))\n        ) {\n          trigger(\n            'Visibility change',\n            'resize',\n            settings[settingId].iframe,\n            settingId\n          );\n        }\n      }\n\n      Object.keys(settings).forEach(function (key) {\n        checkIFrame(key);\n      });\n    }\n\n    function mutationObserved (mutations) {\n      log(\n        'window',\n        'Mutation observed: ' + mutations[0].target + ' ' + mutations[0].type\n      );\n      debouce(checkIFrames, 16);\n    }\n\n    function createMutationObserver () {\n      const target = document.querySelector('body');\n      const config = {\n        attributes: true,\n        attributeOldValue: false,\n        characterData: true,\n        characterDataOldValue: false,\n        childList: true,\n        subtree: true,\n      };\n      const observer = new MutationObserver(mutationObserved);\n\n      observer.observe(target, config);\n    }\n\n    var MutationObserver = getMutationObserver();\n\n    if (MutationObserver) {\n      createMutationObserver();\n    }\n  }\n\n  function resizeIFrames (event) {\n    function resize () {\n      sendTriggerMsg('Window ' + event, 'resize');\n    }\n\n    log('window', 'Trigger event: ' + event);\n    debouce(resize, 16);\n  }\n\n  // Not testable in PhantomJS\n  /* istanbul ignore next */\n  function tabVisible () {\n    function resize () {\n      sendTriggerMsg('Tab Visible', 'resize');\n    }\n\n    if (document.visibilityState !== 'hidden') {\n      log('document', 'Trigger event: Visibility change');\n      debouce(resize, 16);\n    }\n  }\n\n  function sendTriggerMsg (eventName, event) {\n    function isIFrameResizeEnabled (iframeId) {\n      return (\n        settings[iframeId] &&\n        settings[iframeId].resizeFrom === 'parent' &&\n        settings[iframeId].autoResize &&\n        !settings[iframeId].firstRun\n      );\n    }\n\n    Object.keys(settings).forEach(function (iframeId) {\n      if (isIFrameResizeEnabled(iframeId)) {\n        trigger(eventName, event, settings[iframeId].iframe, iframeId);\n      }\n    });\n  }\n\n  function setupEventListeners () {\n    addEventListener(window, 'message', iFrameListener);\n\n    addEventListener(window, 'resize', function () {\n      resizeIFrames('resize');\n    });\n\n    addEventListener(document, 'visibilitychange', tabVisible);\n\n    addEventListener(document, '-webkit-visibilitychange', tabVisible);\n  }\n\n  function factory () {\n    function init (options, element) {\n      function chkType () {\n        if (!element.tagName) {\n          throw new TypeError('Object is not a valid DOM element');\n        } else if (element.tagName.toUpperCase() !== 'IFRAME') {\n          throw new TypeError(\n            'Expected <IFRAME> tag, found <' + element.tagName + '>'\n          );\n        }\n      }\n\n      if (element) {\n        chkType();\n        setupIFrame(element, options);\n        iFrames.push(element);\n      }\n    }\n\n    function warnDeprecatedOptions (options) {\n      if (options && options.enablePublicMethods) {\n        warn(\n          'enablePublicMethods option has been removed, ' +\n          'public methods are now always available in the iFrame'\n        );\n      }\n    }\n\n    let iFrames;\n\n    setupRequestAnimationFrame();\n    setupEventListeners();\n\n    return function iFrameResizeF (options, target) {\n      iFrames = []; // Only return iFrames past in on this call\n\n      warnDeprecatedOptions(options);\n\n      switch (typeof target) {\n        case 'undefined':\n        case 'string': {\n          Array.prototype.forEach.call(\n            document.querySelectorAll(target || 'iframe'),\n            init.bind(undefined, options)\n          );\n          break;\n        }\n\n        case 'object': {\n          init(options, target);\n          break;\n        }\n\n        default: {\n          throw new TypeError('Unexpected data type (' + typeof target + ')');\n        }\n      }\n\n      return iFrames;\n    };\n  }\n\n  if (typeof define === 'function' && define.amd) {\n    define([], factory);\n  } else if (typeof module === 'object' && typeof module.exports === 'object') {\n    // Node for browserfy\n    module.exports = factory();\n  }\n})();\n"],"names":["undefined","window","count","logEnabled","hiddenCheckEnabled","msgHeaderLen","length","msgId","msgIdLen","pagePosition","requestAnimationFrame","resetRequiredMethods","max","scroll","bodyScroll","documentElementScroll","settings","timer","defaults","autoResize","bodyBackground","bodyMargin","bodyMarginV1","bodyPadding","checkOrigin","inPageLinks","enablePublicMethods","heightCalculationMethod","id","interval","log","maxHeight","Infinity","maxWidth","minHeight","minWidth","mouseEvents","resizeFrom","scrolling","sizeHeight","sizeWidth","warningTimeout","tolerance","widthCalculationMethod","onClose","onClosed","onInit","onMessage","warn","onMouseEnter","onMouseLeave","onResized","onScroll","getMutationObserver","MutationObserver","WebKitMutationObserver","MozMutationObserver","addEventListener","el","evt","func","removeEventListener","formatLogHeader","iframeId","retStr","top","self","parentIFrame","getId","getMyID","isLogEnabled","msg","output","type","enabled","console","iFrameListener","event","resizeIFrame","ensureInRange","syncResize","setSize","messageData","setPagePosition","on","getPaddingEnds","compStyle","boxSizing","paddingTop","parseInt","paddingBottom","getBorderEnds","borderTopWidth","borderBottomWidth","Dimension","Number","min","dimension","toLowerCase","size","getMsgBody","offset","slice","indexOf","sendPageInfoToIframe","iframe","fn","time","frameId","trigger","bodyPosition","document","body","getBoundingClientRect","iFramePosition","JSON","stringify","iframeHeight","height","iframeWidth","width","clientHeight","Math","documentElement","innerHeight","clientWidth","innerWidth","offsetTop","offsetLeft","left","scrollTop","pageYOffset","scrollLeft","pageXOffset","documentHeight","documentWidth","windowHeight","windowWidth","getPageInfo","frameTimer","setTimeout","getElementPosition","target","getPagePosition","x","floor","y","scrollRequestFromChild","addOffset","newPosition","scrollTo","unsetPagePosition","onMouse","mousePos","data","split","screenX","screenY","funcName","val","chkEvent","createOutgoingMsg","iFrameReadyMsgReceived","getComputedStyle","processMsg","loaded","retCode","true","false","isMessageFromMetaParent","retBool","hasSettings","checkIFrameExists","origin","constructor","Array","i","checkList","remoteHost","checkSingle","Error","isMessageFromIFrame","firstRun","closeIFrame","msgBody","message","parse","setListener","sendPageInfo","stop","forEach","stopPageInfo","startPageInfoMonitor","location","hash","hashData","decodeURIComponent","getElementById","getElementsByName","jumpPosition","jumpToTarget","moveToAnchor","findTarget","resetIFrame","actionMsg","info","retVal","TypeError","removeIframeListeners","parentNode","removeChild","error","chkZero","checkIFrames","checkIFrame","settingId","chkDimension","style","isVisible","offsetParent","Object","keys","key","mutationObserved","mutations","debouce","createMutationObserver","querySelector","config","attributes","attributeOldValue","characterData","characterDataOldValue","childList","subtree","observe","fixHiddenIFrames","processDimension","setDimension","doNotSync","jasmine","calleeMsg","noResponseWarning","errorShown","contentWindow","targetOrigin","postMessage","postMessageToIFrame","msgTimeout","setupIFrame","options","depricate","splitName","name","charAt","toUpperCase","this","newId","src","ensureHasId","join","checkOptions","option","prototype","hasOwnProperty","call","copyOptions","match","processOptions","overflow","setScrolling","addStyle","styleValue","chkMinMax","setLimits","mutation","removedNodes","removedNode","createDestroyObserver","resetRequertMethod","checkReset","init","iFrameResizer","close","bind","removeListeners","resize","anchor","sendMessage","tabVisible","visibilityState","sendTriggerMsg","eventName","isIFrameResizeEnabled","setupEventListeners","factory","element","tagName","chkType","iFrames","push","vendors","setupRequestAnimationFrame","warnDeprecatedOptions","querySelectorAll","define","amd","module","exports"],"mappings":"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"}